var moyoHistory=[];Moyo=function(){this.spm="?spm=08-17";var a=$("#market-status-bar"),b=$("#marketBox"),e=$("#marketContent").parent();this.showStatus=d;this.addHistory=function(f){if(!moyoHistory.length){moyoHistory.push(0)}if(f.length){moyoHistory.push(f)}};function d(f){a.html("<h3 class='center'>"+f+"</h3>");b.hide();a.slideDown()}this.hideStatus=c;function c(f){a.slideUp(function(){if(f){e.fadeIn()}})}this.addPageJump=function(g){var f=(arguments.length==0?$(".jump"):g);f.off();f.on("click",function(){moyo.home.hideFirstHome();d("载入中");var h=encodeURI($(this).attr("data-dst"));$.ajax({type:"GET",url:"../"+h,success:function(i){moyo.addHistory(h);$("#marketContent").html(i);c(true)},error:function(i){c(true)}});return false})};this.jumpTo=function(f){d("载入中");$.ajax({type:"GET",url:"../"+f,success:function(g){$("#marketContent").html(g);c(true)},error:function(g){c(true)}})},this.jumpBack=function(){if(moyoHistory.length==2){location.reload()}var f="";f=moyoHistory.splice(moyoHistory.length-2,2)[0];moyo.addHistory(f);moyo.jumpTo(f)},this.popMessage=function(i,g){var f=$("#moyo-message"),h=f.children("p");f.attr("title",i);h.html(g);f.dialog({modal:true,buttons:{关闭:function(){$(this).dialog("close")}}})};this.popDiv=function(i,g){var f=$("#moyo-message"),h=f.children("p");f.attr("title",i);h.html(g);return f};this.loadCss=function(h){var f=document.getElementById("loadCss"),g=document.getElementsByTagName("head").item(0);if(f){g.removeChild(f)}css=document.createElement("link");css.href=h;css.rel="stylesheet";css.type="text/css";css.id="loadCss";g.appendChild(css)};this.popSideBar=function(){var g=$("#moyo-sideBar-holder");var f=$(".side");f.on("click",function(){if($(this).hasClass("needLogin")){return false}var i="../"+$(this).attr("href");if(document.getElementById("moyo-sideBar-clone")){$("#moyo-sideBar-clone").remove()}var h=g.html().replace(/moyo-sideBar/,"moyo-sideBar-clone");$("#layout").append(h);h=$("#moyo-sideBar-clone");h.animate({width:$(window).width()/2},260,function(){$.ajax({type:"GET",url:i,success:function(k){$("#moyo-sideBar-clone .m-s-c-inner").html(k)}})});$(".m-s-content").css({height:$(window).height(),"margin-top":$(document).scrollTop()-($(document).scrollTop()>70?100:0)});var j=function(m){var m=m||window.event,k="";if(m.preventDefault){if($.browser.mozilla){k=m.detail>0?"down":"up"}else{k=event.wheelDelta>0?"up":"down"}m.preventDefault();m.stopPropagation()}else{k=event.wheelDelta>0?"up":"down";m.cancelBubble=true;m.returnValue=false}var l=$("#moyo-sideBar-clone .m-s-content"),n=$("#moyo-sideBar-clone .m-s-close");if(k=="down"){l.css("margin-top",parseInt(l.css("margin-top"))-60);n.css("top",parseInt(n.css("top"))+60)}else{l.css("margin-top",parseInt(l.css("margin-top"))+60);n.css("top",parseInt(n.css("top"))-60)}};$(".page").bind("mousewheel",j);if(document.addEventListener&&$.browser.mozilla){document.addEventListener("DOMMouseScroll",j,false)}h.children(".m-s-content").children(".m-s-close").on("click",function(){$(".page").off("mousewheel");if($.browser.mozilla){document.removeEventListener("DOMMouseScroll",j,false)}h.animate({width:0},260,function(){$(this).remove()})});return false})};this.addPopDetail=function(){var f=$(".popDetail");f.on("click",function(){var h=$(this);$.ajax({url:"../Services/"+h.attr("data-service"),type:"POST",data:{action:h.attr("data-action")},success:function(i){g(i,h.attr("data-canBuy"),h);return false}});return false});function g(k,j,i){var h=$("#moyo-popHolder");$("#moyo-popHolder-content").html(k);h.dialog({width:800,modal:true,position:"top"});if(Boolean(j)){$("#moyo-popHolder-functions").removeClass("hide");$("#moyo-popH-f-buy").on("click",function(){h.dialog("close");var m=i.attr("data-left");if(m=="卖完啦！"){moyo.popMessage("Sorry","亲，抱歉这件衣服已经卖完了~");return}var l=i.attr("data-pid");var n=i.children(".fallImages").children(".fallTitle").html();moyo.home.switchToSubForm(n,l)})}}};this.addGotoTopListen=function(){$(window).scroll(function(){var g=$(window).height();var f=$(window).scrollTop();if(f>500){$("#gotop").fadeIn("slow")}else{$("#gotop").fadeOut("fast")}})};this.addHoverClass=function(f){f.hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})};this.addLoginListen=function(){var h=false,g="",f=$(".needLogin");$.ajax({url:"../Services/user.ashx",type:"POST",data:{action:"isLogined"},success:function(i){if(i!="false"){h=true;g=i;if(!f.attr("data-dst")){f.html(g).removeClass("needLogin");return false}if(f.attr("data-dst")=="notChange"){f.removeClass("needLogin");return false}f.removeClass("needLogin").addClass("jump");moyo.addPageJump()}}});if(f.length==0){return false}f.on("click",function(){var i=$(this);if(!i.hasClass("needLogin")){return}$.ajax({url:"login.html",type:"get",success:function(k){var j=moyo.popDiv("用户登录",k);j.dialog({modal:true,width:600});moyo.addHoverClass($("#loginForm .textInput"));moyo.addRegListen();$("#loginForm-i-login").on("click",function(){var m=$("#loginForm input[name=loginForm-i-uid]").val();var l=$("#loginForm input[name=loginForm-i-password]").val();if(m.length==0){alert("请填写用户名");return false}if(l.length==0){alert("请填写密码");return false}$("#loginForm ul").hide();$("#loginForm .statusBar").addClass("loading-big");moyo.userLogin(m,l,function(n){if(n=="True"){j.dialog("close");f.each(function(){if(!$(this).attr("data-dst")){$(this).html(m).removeClass("needLogin")}else{$(this).removeClass("needLogin");if($(this).attr("data-dst")!="notChange"){$(this).addClass("jump")}}});moyo.addPageJump();i.click()}else{$("#loginForm .statusBar").removeClass("loading-big");alert("登录失败,请检查用户名或密码是否正确");$("#loginForm ul").show()}})})}})})};this.inputTip=function(g){if($(".ucinformation").length==0){$("body").prepend("<div class='ucinformation'><div class='ifBox'><div class='ifBoxCont'><div class='ifBoxTxt'></div></div><div class='boxSjOne'>◆</div></div></div>")}var f=g?g:$("input");f.on("hover",function(){if($(this).attr("data-tip")&&$(this).attr("data-tip")!=""){var i=$(this).attr("data-tip");var j=$(this).offset().top;var h=$(this).offset().left;$(".ucinformation .ifBoxTxt").html(i);var k=$(".ucinformation").height();$(".ucinformation").css({left:h,top:j-k-($.browser.msie?1:100)});$(".ucinformation").addClass("informationBlock");$(this).bind("mouseout",function(){$(".ucinformation").removeClass("informationBlock")});$(this).bind("keyup",function(){$(".ucinformation").removeClass("informationBlock")})}else{$(this).off("hover").off("mouseout").off("keyup")}})};this.addRegListen=function(){var f=$("#loginForm-i-reg");f.on("click",function(){$.ajax({url:"reg.html",type:"GET",success:function(h){var g=moyo.popDiv("轻松注册",h);g.dialog({modal:true,width:700});moyo.addHoverClass($("#loginForm .textInput"));moyo.inputTip();moyo.addLoginListen();$("#loginForm-r-reg").on("click",function(){var j={action:"reg",niceName:$("#loginForm input[name=loginForm-i-uid]").val(),realName:$("#loginForm input[name=loginForm-i-name]").val(),sex:$("#loginForm input[name=sex]:checked").val(),Birth:$("#loginForm input[name=birth]:checked").val(),email:$("#loginForm input[name=loginForm-i-QQ]").val()+"@qq.com",phone:$("#loginForm input[name=loginForm-i-phone]").val(),password:$("#loginForm input[name=loginForm-i-password]").val()};for(var k in j){if(j[k].length==0){alert("有没有填写的项目，请填写完整后再提交");return false}}if(j.niceName.length>8||j.niceName.length<2){alert("用户名长度不合适么，应该是2-8位汉字或者英文");return false}if(j.realName.length<2||j.realName.length>6){alert("请填写真实姓名");return false}if(isNaN($("#loginForm input[name=loginForm-i-QQ]").val())){alert("请填写真实的QQ");return false}if(isNaN(j.phone)||j.phone.length!=11){alert("请填写真实的手机号码");return false}if(j.password!=$("#loginForm input[name=loginForm-i-repassword]").val()){alert("两次输入的密码不一致，请重新输入");return false}$("#loginForm ul").hide();$("#loginForm .statusBar").addClass("loading-big");$.ajax({url:"../Services/User.ashx",type:"POST",data:j,success:function(i){if(i=="True"){g.dialog("close")}else{$("#loginForm .statusBar").removeClass("loading-big");alert("用户名已经被别人占用啦！换一个吧");$("#loginForm ul").show()}}})})}});return false})};this.userLogin=function(g,f,h){$.ajax({url:"../Services/User.ashx",type:"POST",data:{action:"login",uid:g,password:f},success:function(i){h(i)}})};this.waitTip=function(){$(".wait").on("click",function(){moyo.popMessage("稍安勿躁","这个频道目前还没有开放，但是马上就要开放了.敬请期待哦亲~");return false})}};Moyo.prototype.home={wheaterGet:function(){var date=new Date();$.ajax({url:"../Services/other.ashx?d="+date.getDate(),type:"POST",data:{action:"weather"},success:function(data){var dataJson=eval("("+data+")").weatherinfo;$("#rightHeaderInfo_data").html(dataJson.date_y+" "+dataJson.week);$("#rightHeaderInfo_temp").html(dataJson.temp1);$("#rightHeaderInfo_weather").html(dataJson.weather1);$("#rightHeaderInfo_index").html(dataJson.index_d);$("#rightHeaderInfo_indexCo").html("舒适指数："+dataJson.index_co)}})},hideFirstHome:function(){var a=$("#splitBar");var b=$("#home");var c=$("#market");b.slideUp("normal").remove();a.css("display","none").remove();c.removeClass("hide")},channelClick:function(){var a=$(".channelItem");var c=$("#marketContent");a.on("click",function(){var d=$(this);if(d.attr("id")=="logo"||d.attr("id")=="homeChannel"){location.reload();return}a.removeClass("activeChannel");d.addClass("activeChannel");var e=new Moyo();e.home.hideFirstHome();e.showStatus("载入中……");e.addHistory(b(d));$.ajax({url:b(d),type:"GET",success:function(f){c.html(f);e.hideStatus(true)},error:function(f){console.log(f)}});$(window).off("scroll");e.addGotoTopListen();e.home.switchToContent();return false});function b(e){var d="";switch(e.attr("id")){case"doorChannel":d="../Markets/Computer/index.html";break;case"infosChannel":d="../Markets/Ecard/index.html";break;case"saleChannel":d="../Markets/Clothes/index.html";break;case"forumChannel":d="../Markets/forum/index.aspx";break;case"livingChannel":d="../Markets/Living/index.aspx";break}return d+moyo.spm}},switchToContent:function(){if($("#marketContent").hasClass("marketContentOnSubmit")){var a=$("#marketContent");var b=$("#subForm");b.fadeOut("slow",function(){a.removeClass("marketContentOnSubmit").animate({left:"0"},"normal")}).hide()}},switchToSubForm:function(a,f){var d=$("#marketContent");var g=$("#subForm");var c=$("#formType");var e=$("#order-gid");d.addClass("marketContentOnSubmit").animate({left:"-3000"},"normal",function(){g.fadeIn("slow");c.val(a);if(!f){f=0}e.val(f)});var b=$("#submitButton");b.on("click",function(){var i=$("#formElm input");i.each(function(){var j=$(this).val();if(j.length==0){$(this).css("background-color","red");moyo.popMessage("提示","您的表单有没有填写的项目，请全部填写后重新提交");return false}else{$(this).css("background-color","white")}});var h={action:"add",title:$("#formType").val(),gid:$("#order-gid").val(),name:$("input[name=order-name]").val(),phone:$("input[name=order-phone]").val(),address:$("input[name=order-address]").val(),eid:$("input[name=order-eid]").val()};if(h.eid==""){h.eid=0}$.ajax({type:"POST",url:"../Services/Sale_Orders.ashx",data:h,success:function(j){if(j=="ok"){moyo.popMessage("恭喜","提交成功，我们的工作人员会尽快与您取得联系。")}else{moyo.popMessage("出错啦","提交失败，请检查所输入的信息是否正确，如果您确定信息无误但无法提交，请致电：0932-8366225。")}moyo.home.switchToContent()}});return false})}};Moyo.prototype.computer={bindSubmit:function(){var a=$(".submitForm");a.on("click",function(){var b=$(this);moyo.home.switchToSubForm(b.attr("data-for"));return false})}};Moyo.prototype.ecard={bindSchoolLogin:function(){var b=$("#ecSchoolMk-serviceList .e-s-login");var c=$("#eCard-login-form");var a=$("#eCard-login-form input[name=permission]");b.on("click",function(){var e=$(this);if(e.hasClass("selected")){c.fadeOut("fast");b.removeClass("selected");return false}var d=$(".ec-l-f-r input[type=text],.ec-l-f-r input[type=password]");d.val("");a.val(e.attr("data-permission"));if(a.val()=="2"){$("#safeKey").css("display","none")}else{$("#safeKey").css("display","")}b.removeClass("selected");$(this).addClass("selected");var f=$(this).parent();c.fadeOut("fast",function(){c.appendTo(f);c.fadeIn("fast")});return false});c.children("form").on("submit",function(){var d=new Moyo();d.showStatus("正在登录……");submitData={action:"login",id:$("#eCard-login-form input[name=uid]").val(),key:$("#eCard-login-form input[name=password]").val(),permission:a.val()};$.ajax({dataType:"json",url:"../Services/School_User.ashx",type:"POST",data:submitData,success:function(e){if(e.rst){d.showStatus("登录成功，请稍后……");$.ajax({type:"GET",url:"../Markets/Ecard/school/teacher_home.aspx",success:function(f){$("#marketContent").html(f);d.hideStatus(true)}})}else{d.hideStatus(true);$("#ecard-loginFail").dialog({height:"170",modal:true,buttons:{确定:function(){$(this).dialog("close")}}})}}});return false})},addExchangeListen:function(){var a=$(".mC-e-g-item button");a.on("click",function(){var b=$(this).attr("data-gid");$.ajax({url:"../Services/Union.ashx?r="+Math.random(),type:"POST",data:{action:"userExchangeAdd",gid:b},success:function(c){if(c=="True"){moyo.popMessage("恭喜","兑换成功！");moyo.jumpTo("Markets/Ecard/live/exchange.aspx?r="+Math.random())}else{moyo.popMessage("错误","您的积分不足以兑换这件礼品")}}})})}};Moyo.prototype.school={teacherDesktopSortabale:function(){var a=$("#schoolEcard-c-functionBox");a.sortable().disableSelection()},teacherDocumentInit:function(){var a=function(){var d=$("#schoolEcard-c-n-s-architecture");var e=$("#schoolEcard-c-n-s-architecture_type");var c=$("#schoolEcard-c-n-architectureAddBox").parent();var f=$("#schoolEcard-c-n-s-architecture-add");f.on("click",function(){if(d.val()=="-1"){moyo.popMessage("提示","没有可以添加的构架");return}if(d.children("option").length==0){moyo.popMessage("提示","没有能添加的构架了。");return}var h=d.children("option").length==1?d.children("option"):d.children("option[selected]");console.log(h.text());var g='<li data-value="'+d.val()+'" data-type="'+e.val()+'" class="schoolEcard-c-n-s-archs">'+h.text()+"</li>";h.remove();c.before(g)})};var b=function(){$("#schoolEcard-c-n-submit button[type=button]").on("click",function(){c(0)});$("#schoolEcard-c-n-submit button[type=submit]").on("click",function(){c(1)});function c(h){editor.sync();var f=$(".schoolEcard-c-n-s-archs");var g="";f.each(function(){g+=$(this).attr("data-value")+"|"+$(this).attr("data-type")+";"});if(g.length==0){moyo.popMessage("错误","请先选择发送对象后再提交");return false}g=g.substring(0,g.length-1);var i=$("#schoolEcard-c-n-b-title input");var d=$("textarea[name=schoolEcard-c-n-b-holder]");var e={action:"addNew",title:i.val(),body:d.val(),status:h==1?true:false,receivers:g};moyo.showStatus("提交中");$.ajax({dataType:"json",type:"POST",url:"../Services/School_Documents.ashx",data:e,success:function(j){if(j.rst){moyo.popMessage("恭喜","公文发布成功~")}else{moyo.popMessage("错误","公文发布失败")}moyo.jumpTo("Markets/Ecard/school/teacher_documents.aspx")}});return false}};a();b()},mailInit:function(){var a=$("#schoolEcard-c-f-tabs-list");a.sortable().disableSelection();var f=$("#schoolEcard-c-f-t-n-sendTo li");f.hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")});var b=$("#schoolEcard-c-f-t-n-sendTo li");var d=[];b.each(function(){d.push({label:$(this).html(),val:$(this).attr("data-uid")})});var e=$("#schoolEcard-c-f-t-n-m-r-addBox input");e.autocomplete({source:d,select:function(g,h){c(h.item.label,h.item.val)}}).data("autocomplete")._renderItem=function(g,h){return $("<li></li>").data("item.autocomplete",h).append("<a>"+h.label+"-"+h.val+"</a>").appendTo(g)};function c(h,i){if($(".theReceiver[data-uid="+i+"]").length>0){moyo.popMessage("提示","不能重复添加联系人");return}var j=$("#schoolEcard-c-n-sendToBox-title");var g='<li class="theReceiver" data-uid="'+i+'">'+h+"</li>";j.after(g)}b.on("click",function(){c($(this).html(),$(this).attr("data-uid"))});$("#schoolEcard-c-f-t-n-m-submit button").on("click",function(){editor.sync();var g="";$("#schoolEcard-c-f-t-n-m-receivers .theReceiver").each(function(){g+=$(this).attr("data-uid")+";"});if(g.length==0){moyo.popMessage("提示","请选择发送对象后重新提交");return}g=g.substring(0,g.length-1);moyo.showStatus("发送中");$.ajax({dataType:"json",type:"POST",url:"../Services/School_mail.ashx",data:{action:"addNew",title:$("#schoolEcard-c-f-t-n-b-title input").val(),body:$("textarea[name=schoolEcard-c-f-t-n-b-holder]").val(),receivers:g},success:function(h){if(h.rst){moyo.popMessage("恭喜","邮件发送成功~")}else{moyo.popMessage("错误","邮件发送失败")}moyo.jumpTo("Markets/Ecard/school/teacher_mail.aspx")}});return false})},filesInit:function(){var a=$("#newUpload")},classInit:function(){var a=$(".schoolEcard-c-f-s-architecture");a.hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});a.on("click",function(){moyo.jumpTo("Markets/Ecard/school/teacher_class.aspx?class="+$(this).attr("data-value"))});$(".student-List-student").draggable({revert:"invalid"});$("#student-List,#student-late-list,#student-leave-list,#student-leaveEarly-list").droppable({activeClass:"ui-state-error ui-corner-all",drop:function(b,c){var d=c.draggable.clone();d.removeClass("ui-draggable-dragging").attr("style","position: relative; ");d.draggable({revert:"invalid"});c.draggable.remove();$(this).append(d)}})},coursewareInit:function(){$("#schoolEcard-c-f-tabs").tabs();$("#submitCourseware").on("click",function(){editor.sync();var d=$("#schoolEcard-c-f-t-n-f-c-title input").val();var a=$("textarea[name=schoolEcard-c-f-t-n-f-holder]").val();var c=$("#schoolEcard-c-f-t-n-f-c-grade select").val();var b=$("#schoolEcard-c-f-t-n-f-c-subject select").val();if(!d.length){moyo.popMessage("错误","标题不能为空");return}if(!a.length){moyo.popMessage("错误","内容不能为空");return}$.ajax({dataType:"json",url:"../Services/School_Courseware.ashx",type:"POST",data:{action:"addNew",title:d,body:a,grade:c,subject:b},success:function(e){if(e.rst){moyo.popMessage("恭喜","发表成功~")}else{moyo.popMessage("错误","发表失败")}moyo.jumpTo("Markets/Ecard/school/teacher_courseware.aspx")}})})}};Moyo.prototype.clothes={fallInit:function(){if(!document.getElementById("clothes-content")){return}var loadIds=[];var holders=[];$(".fall-items").each(function(){loadIds.push($(this).attr("data-pid"))});$(".clothes-c-row").each(function(){holders.push($(this))});function findLast(){var last=loadIds[0];for(var i in loadIds){if(Number(loadIds[i])<Number(last)){last=loadIds[i]}}return last}function isInserted(itemId){for(var i in loadIds){if(loadIds[i]==itemId){return true}}return false}function findSmallHolder(){var holder=holders[0];for(var i in holders){if(holders[i].height()<holder.height()){holder=holders[i]}}return holder}function addNewItem(itemObj){if((!itemObj[0])){return}if(itemObj.length==0){$(window).off("scroll");return false}var item="";if(!isInserted(itemObj[0].id)){loadIds.push(itemObj[0].id);item=$("#fallItem-tp").html().replace(/hide/,"fall-items fallItemsNew").replace(/class=\"hidden\"/,'class="fallItems fallItemsNew"').replace(/\[id\]/,itemObj[0].id).replace(/\[img\]/,itemObj[0].img).replace(/\[title\]/g,itemObj[0].title).replace(/\[like\]/,itemObj[0].like).replace(/\[price\]/,itemObj[0].price).replace(/\[inventory\]/g,itemObj[0].inventory);itemObj.splice(0,1);addNewItemWorker(item,itemObj);moyo.addPopDetail()}}function addNewItemWorker(item,itemObj){var inserted=findSmallHolder().append(item);$(".fallItemsNew").animate({"margin-top":1,opacity:1},"slow",function(){var item=$(this);item.removeClass("fallitemsnew");addNewItem(itemObj)})}$(window).scroll(function(){if($(document).height()-$(document).scrollTop()-$(window).height()<250){$.ajax({url:"../Services/Sale_Clothes.ashx",type:"POST",data:"action=clothesGet&cat=6&last="+findLast()}).success(function(msg){msg=eval("("+msg+")");addNewItem(msg)})}})}};Moyo.prototype.Information={newTopic:function(){var a=$("#topic_content input");var b=$("#topic_content input[name=cid]").val();$("#topic_content button[type=submit]").on("click",function(){var d=$(this);d.hide();editor.sync();var c=$("textarea[name=topicBody]");if(a.val().length==0||c.val().length<20){moyo.popMessage("错误",a.val().length==0?"标题不能为空":"正文内容不得少于10字");d.show();return false}$.ajax({dataType:"json",type:"POST",url:"../Services/Information_Topic.ashx",data:{action:"addNew",cid:b,title:a.val(),body:c.val()},success:function(e){if(!e.rst){moyo.popMessage("错误","发表新帖子失败！")}else{moyo.jumpTo("Markets/Informations/TopicShow.aspx?id="+e.message)}d.show()}});return false})},commentsNewListen:function(){var a=$("#t_p_l_t_comments textarea");var d=$("#t_p_l_t_comments button");var c=$("#t_p_l_t_c_new");var b=$("#t_p_l_t_c_status");d.on("click",function(){if(a.val().length==0){moyo.popMessage("提示","评论内容不能为空");a.focus();return}c.hide();b.addClass("loading-big");$.ajax({dataType:"json",type:"POST",url:"../Services/Information_Topic.ashx",data:{action:"commentsNew",tid:d.attr("data-tid"),body:a.val()},success:function(e){b.removeClass("loading-big");c.show();if(e.rst){a.val("");moyo.popMessage("恭喜","评论添加成功！");$.ajax({url:"../Services/Information_Topic.ashx",type:"POST",data:{action:"commentsGet",pid:d.attr("data-tid")},success:function(f){$("#t_p_l_t_c_list").html(f)}})}else{moyo.popMessage("提示","评论添加失败")}}});return false})},getMoreTopic:function(){var a=$("#loadMoreTopic");a.on("click",function(){if(a.html()=="载入更多帖子中……"){return false}else{a.html("载入更多帖子中……")}var c=$("#t_topic_list table").attr("data-cid"),b=$("#t_topic_list tbody tr:last-child").attr("data-tid");$.ajax({type:"POST",url:"../Services/Information_Topic.ashx",data:{action:"moreTopic",cid:c,last:b},success:function(d){if(d==""){moyo.popMessage("啊哦","没有更多内容了");a.remove();return false}a.html("点击查看更多帖子");$("#t_topic_list .newLoad").removeClass("newLoad");$("#t_topic_list tbody").append(d);moyo.addPageJump()}});return false})}};Moyo.prototype.siteBar={init:function(){moyo.siteBar.homeListen();moyo.siteBar.backListen();moyo.siteBar.joinGroupListen();moyo.siteBar.sslListen()},homeListen:function(){$("#s-i-home").on("click",function(){location.reload()})},backListen:function(){$("#s-i-back").on("click",function(){moyo.jumpBack()})},sslListen:function(){if(document.location.protocol=="https:"){var a=moyo.popDiv("现在是SSL加密模式",'<img src="tipPage\\images\\ssl.jpg" alt="关于SSL加密模式"/>');a.dialog({modal:true,width:740,height:497});$("#s-i-ssl").attr("title","点击退出SSL安全加密模式")}$("#s-i-ssl").on("click",function(){var b="";if(document.location.protocol=="http:"){b="https://"+location.hostname}else{b="http://"+location.hostname}window.location=b})},joinGroupListen:function(){$("#s-i-groupJoin").on("click",function(){var a=moyo.popDiv("提示","复制下面的地址到地址栏即可快速加入定西左邻QQ群<br/><br/>http://qun.qq.com/#jointhegroup/gid/95396686<br/><br/>群号：95396686 V3定西超级群，就差你了,快来吧!");a.dialog({modal:true,width:500,buttons:{关闭:function(){$(this).dialog("close")}}});return false})}};Moyo.prototype.Group={applyBack:function(a){if(a==0){moyo.popMessage("提示","提交申请失败。<br/>请先登录并请确保所有项目已经填写,小组图标已选择。");return}moyo.popMessage("恭喜","圈子创建成功!");$(".m-s-close").click();moyo.jumpTo("Markets/forum/GroupTopicList.aspx?id="+a)},addJoinGroupListen:function(){var a=$(".groupJoin");a.on("click",function(){if(a.hasClass("needLogin")){return false}else{var b=$(this);var d=b.attr("data-isAllow");if(d==0){moyo.popMessage("提示","该小组管理员设置不允许任何人加入");return}var c={action:"join_group_noNeed",gid:$(this).attr("data-gid")};if(d==1){$.ajax({url:"../Services/Information_group.ashx",type:"POST",data:c,success:function(){moyo.popMessage("恭喜","加入小组成功");moyo.jumpTo(moyoHistory[moyoHistory.length-1])},error:function(f){moyo.popMessage("啊哦","加入小组失败");moyo.jumpTo(moyoHistory[moyoHistory.length-1])}})}else{}}})}};Moyo.prototype.Message={uid:"",init:function(){moyo.Message.newComet();moyo.Message.messageSend()},newComet:function(){var url="";if(moyo.Message.uid==""){url="../Services/message.ashx?r="+Math.random()}else{url="../Services/Message_Comet.aspx?r="+Math.random()}$.ajax({url:url,type:"POST",data:{action:(moyo.Message.uid==""?"newUserOnLine":"loop"),uid:moyo.Message.uid},success:function(msg){if(moyo.Message.uid==""){moyo.Message.uid=msg}else{if(typeof(msg)=="string"&&msg.length>0){var newMsg=eval("("+msg+")");$("#th-t-onlineNumber").html(newMsg.onlineCount+"人听到了你说的话");function addMsg(msg){var strClass=(moyo.Message.uid==msg.source||msg.type==-1)?"highlight":"normal";strClass+=" msg"+msg.id;var msgTp=$("#th-messageTpHolder").html();msgTp=msgTp.replace(/\[message\]/,msg.message).replace(/\[class\]/,strClass).replace(/\[by\]/,msg.sourceName).replace(/\[time\]/,msg.time);$("#th-messageHolder").prepend(msgTp);moyo.addPageJump($(".msg"+msg.id+" a"));setTimeout(function(){$(".msg"+msg.id).fadeOut("slow",function(){$(this).remove()})},8000)}addMsg(newMsg)}}moyo.Message.newComet()},error:function(){moyo.Message.newComet()}})},messageSend:function(){var a="";$("#th-t-message").on("keydown",function(b){if(b.which==13){a=$("#th-t-message").val();$("#th-t-message").val("");$.ajax({url:"../Services/Message.ashx?r="+Math.random(),type:"POST",data:{action:"newMessage",message:a,uid:moyo.Message.uid},success:function(c){}});return false}})}};Moyo.prototype.Living={newShopHover:function(){var a=$(".t-c-newShop ul li");a.on("hover",function(){var b=$(this);$(".t-c-newShop .show").removeClass("show").addClass("hide");$(".t-c-newShop ul li h4.hide").removeClass("hide");b.children("h4").addClass("hide");b.children(".t-c-i-detal").removeClass("hide").addClass("show")})},rateInit:function(){$(".rates").raty({score:function(){return $(this).attr("data-rated")},half:true,hints:["糟糕透了","糟糕","不行","非常一般","一般","还凑合","不错","挺好的","棒","太棒了"],number:10,click:function(b,a){$(this).parent().children("input").val(b)}});$("#d-s-m-r-submit").on("click",function(){var a={action:"add",sid:$("#detal-shop").attr("data-sid"),point:$("#d-s-m-r-s-point").val(),price:$("#d-s-m-r-s-price").val(),service:$("#d-s-m-r-s-service").val(),circumstance:$("#d-s-m-r-s-circumstance").val(),comment:$("#d-s-m-r-comment").val()};for(var b in a){if(a[b].length==0){moyo.popMessage("提示","所有评分项都要评分，评语也不能为空哦~评完了再提交吧。");return}}$(this).hide();$.ajax({type:"POST",url:"../Services/living_shop_comment.ashx",data:a,success:function(c){moyo.popMessage("恭喜","评论成功");$(".m-s-close").click()}})})},mapInit:function(){if(typeof(soso)=="undefined"){var a=document.createElement("script");a.type="text/javascript";a.src="http://api.map.soso.com/v1.0/main.js?callback=mapCallBack";document.body.appendChild(a)}else{mapCallBack()}},mapCallBack:function(){var f=$("#d-s-m-map");var c=new soso.maps.LatLng(f.attr("data-lng"),f.attr("data-lat"));var b={zoom:8,center:c,mapTypeId:soso.maps.MapTypeId.ROADMAP,zoomLevel:15};var e=new soso.maps.Map(f[0],b);var d=new soso.maps.LatLng(f.attr("data-lng"),f.attr("data-lat"));var a=new soso.maps.Marker({position:d,map:e})}};$(document).ready(function(){moyo=new Moyo();moyo.home.channelClick();moyo.home.wheaterGet();moyo.addLoginListen();moyo.inputTip($(".needTip"));moyo.siteBar.init();moyo.addHoverClass($("#order-form li"))});